# A2UI é¡¹ç›®å‰ç«¯éƒ¨åˆ†åˆ†ææŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**A2UI (Agent-to-User Interface)** æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå…è®¸ AI ä»£ç†é€šè¿‡å£°æ˜å¼ JSON æ ¼å¼ç”Ÿæˆå’Œæ›´æ–°ç”¨æˆ·ç•Œé¢ã€‚å‰ç«¯éƒ¨åˆ†ä¸»è¦è´Ÿè´£å°†ä»£ç†å‘é€çš„ A2UI JSON æ¶ˆæ¯æ¸²æŸ“ä¸ºåŸç”Ÿ Web ç»„ä»¶ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **å®‰å…¨æ€§ä¼˜å…ˆ**ï¼šä½¿ç”¨å£°æ˜å¼æ•°æ®æ ¼å¼è€Œéå¯æ‰§è¡Œä»£ç ï¼Œç¡®ä¿å®‰å…¨æ€§
- **LLM å‹å¥½**ï¼šUI è¡¨ç¤ºä¸ºæ‰å¹³ç»„ä»¶åˆ—è¡¨ï¼Œæ˜“äº LLM å¢é‡ç”Ÿæˆ
- **æ¡†æ¶æ— å…³**ï¼šåˆ†ç¦» UI ç»“æ„ä¸å®ç°ï¼Œæ”¯æŒå¤šç§å‰ç«¯æ¡†æ¶
- **çµæ´»æ€§**ï¼šæ”¯æŒè‡ªå®šä¹‰ç»„ä»¶æ³¨å†Œå’Œæ‰©å±•

---

## ğŸ—ï¸ å‰ç«¯æ¶æ„

### 1. é¡¹ç›®ç»“æ„

```
A2UI/
â”œâ”€â”€ renderers/              # æ¸²æŸ“å™¨å®ç°
â”‚   â”œâ”€â”€ lit/               # Lit æ¸²æŸ“å™¨ï¼ˆä¸»è¦å‰ç«¯å®ç°ï¼‰
â”‚   â””â”€â”€ angular/           # Angular æ¸²æŸ“å™¨
â”œâ”€â”€ samples/               # ç¤ºä¾‹åº”ç”¨
â”‚   â””â”€â”€ client/
â”‚       â””â”€â”€ lit/           # Lit å®¢æˆ·ç«¯ç¤ºä¾‹
â”‚           â”œâ”€â”€ shell/     # Shell åº”ç”¨
â”‚           â”œâ”€â”€ restaurant/ # é¤å…æŸ¥æ‰¾ç¤ºä¾‹
â”‚           â””â”€â”€ contact/   # è”ç³»äººæŸ¥æ‰¾ç¤ºä¾‹
â””â”€â”€ specification/         # A2UI åè®®è§„èŒƒ
```

---

## ğŸ”§ Lit æ¸²æŸ“å™¨æ ¸å¿ƒæ¶æ„

### 2.1 æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Lit 3.3.1 (Google çš„ Web Components æ¡†æ¶)
- **è¯­è¨€**: TypeScript (ES2022+)
- **æ„å»ºå·¥å…·**: TypeScript Compiler + Wireit
- **å“åº”å¼**: @lit-labs/signals (ä¿¡å·ç³»ç»Ÿ)
- **æ ·å¼**: CSS-in-JS (Lit çš„ `css` æ¨¡æ¿æ ‡ç­¾)
- **Markdown**: markdown-it (ç”¨äºæ–‡æœ¬æ¸²æŸ“)

### 2.2 æ ¸å¿ƒä¾èµ–

```json
{
  "lit": "^3.3.1",
  "@lit-labs/signals": "^0.1.3",
  "@lit/context": "^1.1.4",
  "markdown-it": "^14.1.0",
  "signal-utils": "^0.21.1"
}
```

### 2.3 ç›®å½•ç»“æ„

```
renderers/lit/src/0.8/
â”œâ”€â”€ core.ts                    # æ ¸å¿ƒå¯¼å‡º
â”œâ”€â”€ index.ts                    # å…¥å£æ–‡ä»¶
â”‚
â”œâ”€â”€ data/                       # æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ guards.ts              # ç±»å‹å®ˆå«
â”‚   â”œâ”€â”€ model-processor.ts      # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â””â”€â”€ signal-model-processor.ts # ä¿¡å·å¼æ¶ˆæ¯å¤„ç†å™¨
â”‚
â”œâ”€â”€ events/                     # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ a2ui.ts                # A2UI äº‹ä»¶
â”‚   â”œâ”€â”€ base.ts                # åŸºç¡€äº‹ä»¶
â”‚   â””â”€â”€ events.ts              # äº‹ä»¶å®šä¹‰
â”‚
â”œâ”€â”€ schemas/                    # JSON Schema å®šä¹‰
â”‚   â”œâ”€â”€ server_to_client.json
â”‚   â”œâ”€â”€ client_to_server.json
â”‚   â””â”€â”€ standard_catalog_definition.json
â”‚
â”œâ”€â”€ styles/                     # æ ·å¼ç³»ç»Ÿ
â”‚   â”œâ”€â”€ colors.ts              # é¢œè‰²å®šä¹‰
â”‚   â”œâ”€â”€ layout.ts               # å¸ƒå±€æ ·å¼
â”‚   â”œâ”€â”€ type.ts                 # å­—ä½“æ ·å¼
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ types/                      # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ components.ts          # ç»„ä»¶ç±»å‹
â”‚   â”œâ”€â”€ primitives.ts          # åŸºç¡€ç±»å‹
â”‚   â””â”€â”€ types.ts               # æ ¸å¿ƒç±»å‹
â”‚
â””â”€â”€ ui/                         # UI ç»„ä»¶å®ç°
    â”œâ”€â”€ root.ts                # æ ¹ç»„ä»¶ï¼ˆæ ¸å¿ƒæ¸²æŸ“é€»è¾‘ï¼‰
    â”œâ”€â”€ surface.ts             # Surface å®¹å™¨
    â”œâ”€â”€ component-registry.ts  # ç»„ä»¶æ³¨å†Œè¡¨
    â”‚
    â”œâ”€â”€ context/                # Context API
    â”‚   â””â”€â”€ theme.ts           # ä¸»é¢˜ä¸Šä¸‹æ–‡
    â”‚
    â”œâ”€â”€ custom-components/     # è‡ªå®šä¹‰ç»„ä»¶æ”¯æŒ
    â”‚
    â”œâ”€â”€ directives/            # Lit æŒ‡ä»¤
    â”‚   â”œâ”€â”€ markdown.ts       # Markdown æ¸²æŸ“
    â”‚   â””â”€â”€ sanitizer.ts      # HTML æ¸…ç†
    â”‚
    â””â”€â”€ [ç»„ä»¶æ–‡ä»¶]             # å„ç§ UI ç»„ä»¶
        â”œâ”€â”€ button.ts
        â”œâ”€â”€ card.ts
        â”œâ”€â”€ text-field.ts
        â”œâ”€â”€ list.ts
        â””â”€â”€ ...
```

---

## ğŸ¨ UI ç»„ä»¶ç³»ç»Ÿ

### 3.1 æ ‡å‡†ç»„ä»¶åˆ—è¡¨

A2UI Lit æ¸²æŸ“å™¨å®ç°äº†ä»¥ä¸‹æ ‡å‡†ç»„ä»¶ï¼š

| ç»„ä»¶ | æ ‡ç­¾å | ç”¨é€” |
|------|--------|------|
| **Root** | `a2ui-root` | æ ¹ç»„ä»¶ï¼Œè´Ÿè´£ç»„ä»¶æ ‘æ¸²æŸ“ |
| **Surface** | `a2ui-surface` | Surface å®¹å™¨ï¼Œç®¡ç†ç‹¬ç«‹ UI åŒºåŸŸ |
| **Text** | `a2ui-text` | æ–‡æœ¬æ˜¾ç¤º |
| **Button** | `a2ui-button` | æŒ‰é’® |
| **Card** | `a2ui-card` | å¡ç‰‡å®¹å™¨ |
| **TextField** | `a2ui-textfield` | æ–‡æœ¬è¾“å…¥æ¡† |
| **Checkbox** | `a2ui-checkbox` | å¤é€‰æ¡† |
| **DateTimeInput** | `a2ui-datetimeinput` | æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ |
| **Slider** | `a2ui-slider` | æ»‘å— |
| **List** | `a2ui-list` | åˆ—è¡¨ |
| **Row** | `a2ui-row` | è¡Œå¸ƒå±€ |
| **Column** | `a2ui-column` | åˆ—å¸ƒå±€ |
| **Tabs** | `a2ui-tabs` | æ ‡ç­¾é¡µ |
| **Modal** | `a2ui-modal` | æ¨¡æ€æ¡† |
| **Image** | `a2ui-image` | å›¾ç‰‡ |
| **Video** | `a2ui-video` | è§†é¢‘ |
| **Audio** | `a2ui-audioplayer` | éŸ³é¢‘æ’­æ”¾å™¨ |
| **Icon** | `a2ui-icon` | å›¾æ ‡ |
| **Divider** | `a2ui-divider` | åˆ†å‰²çº¿ |
| **MultipleChoice** | `a2ui-multiplechoice` | å¤šé€‰ç»„ä»¶ |

### 3.2 ç»„ä»¶æ³¨å†Œæœºåˆ¶

```typescript
// component-registry.ts
export class ComponentRegistry {
  // æ³¨å†Œè‡ªå®šä¹‰ç»„ä»¶
  register(type: string, constructor: CustomElementConstructor): void
  
  // è·å–å·²æ³¨å†Œç»„ä»¶
  get(type: string): CustomElementConstructor | undefined
}

// å…¨å±€æ³¨å†Œè¡¨å®ä¾‹
export const componentRegistry = new ComponentRegistry();
```

### 3.3 Root ç»„ä»¶æ ¸å¿ƒé€»è¾‘

`Root` ç»„ä»¶æ˜¯æ¸²æŸ“ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œè´Ÿè´£ï¼š

1. **æ¶ˆæ¯å¤„ç†**: æ¥æ”¶å¹¶å¤„ç† A2UI JSON æ¶ˆæ¯
2. **ç»„ä»¶æ ‘æ¸²æŸ“**: å°† JSON æè¿°è½¬æ¢ä¸º Lit ç»„ä»¶æ ‘
3. **æ•°æ®ç»‘å®š**: ç®¡ç†æ•°æ®æ¨¡å‹ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š
4. **äº‹ä»¶å¤„ç†**: å¤„ç†ç”¨æˆ·äº¤äº’äº‹ä»¶å¹¶å‘é€å›ä»£ç†

å…³é”®ç‰¹æ€§ï¼š
- ä½¿ç”¨ `SignalWatcher` å®ç°å“åº”å¼æ›´æ–°
- æ”¯æŒè‡ªå®šä¹‰ç»„ä»¶æ³¨å†Œå’Œè¦†ç›–
- æ”¯æŒ Light DOM æ¸²æŸ“
- æ”¯æŒæ•°æ®ä¸Šä¸‹æ–‡è·¯å¾„ï¼ˆ`dataContextPath`ï¼‰

---

## ğŸ“¡ æ•°æ®æµä¸æ¶ˆæ¯å¤„ç†

### 4.1 æ¶ˆæ¯å¤„ç†æµç¨‹

```
Agent (Python)
    â†“ (å‘é€ A2UI JSON æ¶ˆæ¯)
A2uiMessageProcessor
    â†“ (è§£ææ¶ˆæ¯)
DataModel (SignalMap)
    â†“ (æ•°æ®ç»‘å®š)
UI Components (Lit Elements)
    â†“ (ç”¨æˆ·äº¤äº’)
Client Events
    â†“ (å‘é€å›ä»£ç†)
Agent
```

### 4.2 æ¶ˆæ¯ç±»å‹

A2UI æ”¯æŒä¸‰ç§ä¸»è¦æ¶ˆæ¯ç±»å‹ï¼š

1. **SurfaceUpdate**: å®šä¹‰/æ›´æ–° UI ç»„ä»¶
   ```json
   {
     "surfaceUpdate": {
       "surfaceId": "main",
       "components": [...]
     }
   }
   ```

2. **DataModelUpdate**: æ›´æ–°æ•°æ®æ¨¡å‹
   ```json
   {
     "dataModelUpdate": {
       "surfaceId": "main",
       "contents": [...]
     }
   }
   ```

3. **BeginRendering**: è§¦å‘æ¸²æŸ“
   ```json
   {
     "beginRendering": {
       "surfaceId": "main",
       "root": "component-id"
     }
   }
   ```

### 4.3 æ•°æ®æ¨¡å‹å¤„ç†å™¨

- **A2uiMessageProcessor**: åŸºç¡€æ¶ˆæ¯å¤„ç†å™¨
- **SignalA2uiMessageProcessor**: åŸºäºä¿¡å·çš„å“åº”å¼å¤„ç†å™¨ï¼ˆæ¨èï¼‰

---

## ğŸ¯ å®¢æˆ·ç«¯ç¤ºä¾‹åº”ç”¨

### 5.1 ç¤ºä¾‹ç»“æ„

```
samples/client/lit/
â”œâ”€â”€ shell/              # Shell åº”ç”¨ï¼ˆä¸»ç•Œé¢ï¼‰
â”œâ”€â”€ restaurant/         # é¤å…æŸ¥æ‰¾ç¤ºä¾‹
â””â”€â”€ contact/            # è”ç³»äººæŸ¥æ‰¾ç¤ºä¾‹
```

### 5.2 è¿è¡Œæ–¹å¼

```bash
# å®‰è£…ä¾èµ–
cd samples/client/lit
npm install

# æ„å»ºæ¸²æŸ“å™¨
npm run build:renderer

# è¿è¡Œå®Œæ•´æ¼”ç¤ºï¼ˆåŒ…å«å¤šä¸ªä»£ç†ï¼‰
npm run demo:all

# æˆ–è¿è¡Œå•ä¸ªç¤ºä¾‹
npm run demo:restaurant
```

### 5.3 å¼€å‘æµç¨‹

1. **å¯åŠ¨ä»£ç†** (Python): è¿è¡Œ A2A ä»£ç†æœåŠ¡å™¨
2. **å¯åŠ¨å®¢æˆ·ç«¯** (Node.js): è¿è¡Œ Vite å¼€å‘æœåŠ¡å™¨
3. **è¿æ¥**: å®¢æˆ·ç«¯é€šè¿‡ WebSocket è¿æ¥åˆ°ä»£ç†
4. **äº¤äº’**: ç”¨æˆ·åœ¨ Web UI ä¸­è¾“å…¥ï¼Œä»£ç†ç”Ÿæˆ A2UI JSONï¼Œå®¢æˆ·ç«¯æ¸²æŸ“

---

## ğŸ” å®‰å…¨è€ƒè™‘

### 6.1 å®‰å…¨åŸåˆ™

âš ï¸ **é‡è¦æç¤º**: A2UI å¼ºè°ƒå°†æ¥è‡ªå¤–éƒ¨ä»£ç†çš„æ•°æ®è§†ä¸º**ä¸å¯ä¿¡è¾“å…¥**

1. **è¾“å…¥éªŒè¯**: æ‰€æœ‰æ¥è‡ªä»£ç†çš„ UI å®šä¹‰å’Œæ•°æ®å¿…é¡»éªŒè¯
2. **XSS é˜²æŠ¤**: ä½¿ç”¨ HTML æ¸…ç†å™¨é˜²æ­¢è„šæœ¬æ³¨å…¥
3. **CSP**: å®æ–½å†…å®¹å®‰å…¨ç­–ç•¥
4. **æ²™ç®±éš”ç¦»**: å¯¹ iframe ç­‰åµŒå…¥å†…å®¹è¿›è¡Œä¸¥æ ¼éš”ç¦»
5. **æç¤ºæ³¨å…¥é˜²æŠ¤**: é˜²æ­¢æ¶æ„ä»£ç†é€šè¿‡ UI å­—æ®µè¿›è¡Œæç¤ºæ³¨å…¥æ”»å‡»

### 6.2 å®‰å…¨æªæ–½

- HTML æ¸…ç†å™¨ (`directives/sanitizer.ts`)
- Markdown å®‰å…¨æ¸²æŸ“
- ç»„ä»¶ç™½åå•æœºåˆ¶
- æ•°æ®è·¯å¾„éªŒè¯

---

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### 7.1 æ„å»ºé¡¹ç›®

```bash
cd renderers/lit

# å®‰è£…ä¾èµ–
npm install

# æ„å»º
npm run build

# å¼€å‘æ¨¡å¼ï¼ˆå¸¦ watchï¼‰
npm run dev

# è¿è¡Œæµ‹è¯•
npm run test
```

### 7.2 ä½¿ç”¨æ¸²æŸ“å™¨

```typescript
import { Surface, createSignalA2uiMessageProcessor } from '@a2ui/lit/0.8';

// åˆ›å»ºæ¶ˆæ¯å¤„ç†å™¨
const processor = createSignalA2uiMessageProcessor();

// å¤„ç† A2UI æ¶ˆæ¯
processor.processMessage(a2uiJsonMessage);

// åœ¨ HTML ä¸­ä½¿ç”¨
// <a2ui-surface surface-id="main"></a2ui-surface>
```

### 7.3 è‡ªå®šä¹‰ç»„ä»¶

```typescript
import { componentRegistry } from '@a2ui/lit/ui';

// æ³¨å†Œè‡ªå®šä¹‰ç»„ä»¶
componentRegistry.register('my-custom-component', MyCustomElement);
```

---

## ğŸ“Š æŠ€æœ¯ç‰¹ç‚¹åˆ†æ

### 8.1 ä¼˜åŠ¿

âœ… **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰  
âœ… **å“åº”å¼**: åŸºäºä¿¡å·çš„å“åº”å¼æ›´æ–°ç³»ç»Ÿ  
âœ… **æ¨¡å—åŒ–**: æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Œæ˜“äºæ‰©å±•  
âœ… **æ ‡å‡†å…¼å®¹**: éµå¾ª Web Components æ ‡å‡†  
âœ… **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ Lit çš„å¢é‡æ›´æ–°æœºåˆ¶  

### 8.2 æŠ€æœ¯äº®ç‚¹

1. **ä¿¡å·ç³»ç»Ÿ**: ä½¿ç”¨ `@lit-labs/signals` å®ç°ç»†ç²’åº¦å“åº”å¼æ›´æ–°
2. **Context API**: ä½¿ç”¨ `@lit/context` å®ç°ä¸»é¢˜ç­‰å…¨å±€çŠ¶æ€ç®¡ç†
3. **ç»„ä»¶æ³¨å†Œè¡¨**: çµæ´»çš„ç»„ä»¶æ³¨å†Œæœºåˆ¶ï¼Œæ”¯æŒè¿è¡Œæ—¶æ‰©å±•
4. **æ•°æ®ç»‘å®š**: æ”¯æŒè·¯å¾„å¼æ•°æ®ç»‘å®š (`/path/to/data`)
5. **æ¸è¿›å¼æ¸²æŸ“**: æ”¯æŒå¢é‡æ›´æ–°ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

### 8.3 å¯æ”¹è¿›ç‚¹

- æ–‡æ¡£å¯ä»¥æ›´è¯¦ç»†ï¼ˆç‰¹åˆ«æ˜¯ API æ–‡æ¡£ï¼‰
- å¯ä»¥æ·»åŠ æ›´å¤šç¤ºä¾‹
- å¯ä»¥å¢åŠ å•å…ƒæµ‹è¯•è¦†ç›–ç‡
- å¯ä»¥æ·»åŠ  Storybook ç­‰ç»„ä»¶æ–‡æ¡£å·¥å…·

---

## ğŸ“š ç›¸å…³èµ„æº

### 9.1 å…³é”®æ–‡ä»¶

- **æ ¸å¿ƒå…¥å£**: `renderers/lit/src/index.ts`
- **æ ¸å¿ƒé€»è¾‘**: `renderers/lit/src/0.8/core.ts`
- **UI å¯¼å‡º**: `renderers/lit/src/0.8/ui/ui.ts`
- **æ ¹ç»„ä»¶**: `renderers/lit/src/0.8/ui/root.ts`
- **Surface**: `renderers/lit/src/0.8/ui/surface.ts`

### 9.2 æ–‡æ¡£

- å¿«é€Ÿå¼€å§‹: `docs/quickstart.md`
- è§„èŒƒå®šä¹‰: `specification/`
- README: `renderers/lit/README.md`

---

## ğŸ“ æ€»ç»“

A2UI çš„å‰ç«¯éƒ¨åˆ†æ˜¯ä¸€ä¸ª**è®¾è®¡ç²¾è‰¯ã€æ¶æ„æ¸…æ™°**çš„ Web Components æ¸²æŸ“ç³»ç»Ÿã€‚å®ƒä½¿ç”¨ç°ä»£ Web æŠ€æœ¯æ ˆï¼ˆLit + TypeScript + Signalsï¼‰ï¼Œå®ç°äº†å°†å£°æ˜å¼ JSON è½¬æ¢ä¸ºäº¤äº’å¼ UI çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

**æ ¸å¿ƒä»·å€¼**:
- ä¸º AI ä»£ç†æä¾›äº†å®‰å…¨ã€æ ‡å‡†çš„ UI ç”Ÿæˆèƒ½åŠ›
- å®ç°äº†æ¡†æ¶æ— å…³çš„ UI æè¿°æ ¼å¼
- æä¾›äº†å®Œæ•´çš„ç±»å‹å®‰å…¨å’Œå¼€å‘ä½“éªŒ

**é€‚ç”¨åœºæ™¯**:
- AI åŠ©æ‰‹åº”ç”¨
- åŠ¨æ€è¡¨å•ç”Ÿæˆ
- ä»£ç†é©±åŠ¨çš„ç”¨æˆ·ç•Œé¢
- è·¨å¹³å° UI ç”Ÿæˆ

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025å¹´*  
*é¡¹ç›®ç‰ˆæœ¬: v0.8.1*
